{% extends "layout.html" %}
{% block title %} Compare Benchmarks {% endblock %}

{% block content %}

<h1>Benchmark System</h1>
<form action="{{ base_path }}/compare" method="get">
    <input type="text" name="file1"></input>
    <input type="text" name="file2"></input>
    <label for="metrics"> Choose a metric:</label>
    <select id="metrics" name="metrics">
        <option value="best">best</option>
        <option value="median">median</option>
    </select>
    <input type="submit" value="compare"></input>
</form>

{% if file1 is not none and file2 is not none %}
    <table class="data-table">
        <thead>
        <tr>
            <th>name</th>
            <th>ratio of first to second</th>
            <th>
                {% if benchmarks1['sha'] is not none %}
                <a href="{{ base_path }}/?file={{ file1 }}">{{ benchmarks1['sha'] }}</a>
                {% else %}
                unknown
                {% endif %}
            </th>
            <th>
                {% if benchmarks2['sha'] is not none %}
                <a href="{{ base_path }}/?file={{ file2 }}">{{ benchmarks2['sha'] }}</a>
                {% else %}
                unknown
                {% endif %}
            </th>
        </tr>
        </thead>
        <tbody>
        {% for d in benchmarks1['data'] %}
        <tr>
            <td>{{ d['name'] }}</td>
            {% for item in benchmarks2['data'] if item['name'] == d['name'] %}
                <td>
<!--                    {% if item is not none %}-->
<!--                        {% set ratio = d['mean'] / item['mean'] %}-->
<!--                        {{'%0.3f'| format(ratio|float)}}-->
<!--                    {% endif %}-->
                    {% if metric == 'median' %}
                        {% set ratio = d['median'] / item['median'] %}
                        {{ ('%0.3f'| format(ratio|float)) * 100 }}
                    {% else %}
                        {% set ratio = (d['times'] | min) / (item['times'] | min) %}
                        {{ ('%0.3f'| format(ratio|float)) * 100 }}
                    {% endif %}
                </td>
                <td>
                    {% if metric == 'median' %}
                        {{ d['median'] }}
                    {% else %}
                        {{ (d['times'] | min) }}
                    {% endif %}
                </td>
                <td>
                    {% if metric == 'median' %}
                        {{ item['median'] }}
                    {% else %}
                        {{ (item['times'] | min) }}
                    {% endif %}
                </td>
            {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <p> Harmonic Mean: </p>
    <p> Geometric Mean: {{ benchmarks2['geometric_mean'] / benchmarks1['geometric_mean'] }} </p>
    <p> Arithmetic Mean: </p>
    <p> Median: </p>
    <hr>
{% endif %}

{% endblock %}