{% extends "layout.html" %}
{% block title %} Compare Benchmarks {% endblock %}

{% block content %}

<h1>Benchmark System</h1>
<div class="flex-col-align-left">
    <form method="get" action="{{ base_path }}/compare">
        <label for="file1">File 1:</label>
        <input style="vertical-align:text-bottom;" name="file1" size=30 type="text" required
               {% if start %}
               value = "{{ file1 }}"
               {% else %}
               placeholder="gs://..."
               {% endif %}
        ><br>
        <label for="file2">File 2:</label>
        <input style="vertical-align:text-bottom;" name="file2" size=30 type="text" required
               {% if end %}
               value = "{{ file2 }}"
               {% else %}
               placeholder="gs://..."
               {% endif %}
        ><br>
<!--        <input type="text" name="file1"></input>-->
<!--        <input type="text" name="file2"></input>-->
        <label for="metrics">Choose a metric:</label>
        <select id="metrics" name="metrics">
            <option value="best">best</option>
            <option value="median">median</option>
        </select>
        <button type="submit">Compare</button>
    </form>
</div>

{% if file1 is not none and file2 is not none %}
    <table class="data-table">
        <thead>
        <tr>
            <th>name</th>
            <th>ratio of first to second</th>
            <th>
                {% if benchmarks1['sha'] is not none %}
                <a href="{{ base_path }}/?file={{ file1 }}">{{ benchmarks1['sha'] }}</a>
                {% else %}
                unknown
                {% endif %}
            </th>
            <th>
                {% if benchmarks2['sha'] is not none %}
                <a href="{{ base_path }}/?file={{ file2 }}">{{ benchmarks2['sha'] }}</a>
                {% else %}
                unknown
                {% endif %}
            </th>
        </tr>
        </thead>
        <tbody>
<!--        {% for d in benchmarks1['data'] %}-->
<!--        <tr>-->
<!--            <td>{{ d['name'] }}</td>-->
<!--            {% for item in benchmarks2['data'] if item['name'] == d['name'] %}-->
<!--                <td>-->
<!--&lt;!&ndash;                    {% if item is not none %}&ndash;&gt;-->
<!--&lt;!&ndash;                        {% set ratio = d['mean'] / item['mean'] %}&ndash;&gt;-->
<!--&lt;!&ndash;                        {{'%0.3f'| format(ratio|float)}}&ndash;&gt;-->
<!--&lt;!&ndash;                    {% endif %}&ndash;&gt;-->
<!--                    {% if metric == 'median' %}-->
<!--                        {% set ratio = d['median'] / item['median'] %}-->
<!--                        {{ ('%0.3f'| format(ratio|float)) }}-->
<!--                    {% else %}-->
<!--                        {% set ratio = (d['times'] | min) / (item['times'] | min) %}-->
<!--                        {{ ('%0.3f'| format(ratio|float)) }}-->
<!--                    {% endif %}-->
<!--                </td>-->
<!--                <td>-->
<!--                    {% if metric == 'median' %}-->
<!--                        {{ d['median'] }}-->
<!--                    {% else %}-->
<!--                        {{ (d['times'] | min) }}-->
<!--                    {% endif %}-->
<!--                </td>-->
<!--                <td>-->
<!--                    {% if metric == 'median' %}-->
<!--                        {{ item['median'] }}-->
<!--                    {% else %}-->
<!--                        {{ (item['times'] | min) }}-->
<!--                    {% endif %}-->
<!--                </td>-->
<!--            {% endfor %}-->
<!--        </tr>-->
<!--        {% endfor %}-->
        {% for name, ratio, r1, r2 in comparisons['comps'] %}
        <tr>
            <td>{{ name }}</td>
            <td>{{ ratio }}%</td>
            <td>{{ r1 }}</td>
            <td>{{ r2 }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <p> Harmonic Mean: {{ comparisons['harmonic_mean'] }}% </p>
    <p> Geometric Mean: {{ comparisons['geometric_mean'] }}% </p>
    <p> Arithmetic Mean: {{ comparisons['arithmetic_mean'] }}%</p>
    <p> Median: {{ comparisons['median'] }}%</p>
{% endif %}

{% endblock %}